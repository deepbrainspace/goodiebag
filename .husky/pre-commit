# Block direct commits to main branch
if [ "$(git rev-parse --abbrev-ref HEAD)" = "main" ]; then
  echo "❌ Direct commits to main branch are not allowed"
  echo "💡 Create a feature branch: git checkout -b feature/your-feature"
  exit 1
fi

# Check for potential secrets (exclude .husky directory)
STAGED_FILES=$(git diff --cached --name-only | grep -v "^\.husky/")
if [ -n "$STAGED_FILES" ] && echo "$STAGED_FILES" | xargs grep -l -E "(api[_-]?key|secret|token|password|pwd)\s*[:=]" 2>/dev/null | head -1 >/dev/null; then
  echo "⚠️  Potential secrets detected in staged files!"
  echo "🔍 Files containing potential secrets:"
  echo "$STAGED_FILES" | xargs grep -l -E "(api[_-]?key|secret|token|password|pwd)\s*[:=]" 2>/dev/null
  echo ""
  echo "💡 Please review and ensure no actual secrets are being committed"
  echo "❓ Continue anyway? (y/N)"
  read -r response
  if [ "$response" != "y" ] && [ "$response" != "Y" ]; then
    echo "🚫 Commit aborted"
    exit 1
  fi
fi

# Format affected files with NX
nx format:write --uncommitted
