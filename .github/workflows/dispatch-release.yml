name: 🚀 Release Dispatcher

on:
  pull_request:
    types: [closed]

jobs:
  dispatch-prepare:
    name: 📝 Dispatch Prepare Release
    runs-on: ubuntu-latest
    if: "github.event.pull_request.merged == true && ! startsWith(github.head_ref, 'release/')"
    steps:
      - name: Trigger prepare workflow
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/prepare.yml/dispatches \
            -d '{
              "ref": "main",
              "inputs": {
                "pr_number": "${{ github.event.pull_request.number }}",
                "head_ref": "${{ github.head_ref }}",
                "head_sha": "${{ github.event.pull_request.head.sha }}",
                "base_ref": "${{ github.base_ref }}"
              }
            }'

  dispatch-release:
    name: 🚀 Dispatch Release Publish
    runs-on: ubuntu-latest
    if: "github.event.pull_request.merged == true && startsWith(github.head_ref, 'release/')"
    steps:
      - name: Trigger release workflow
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/release.yml/dispatches \
            -d '{
              "ref": "main",
              "inputs": {
                "pr_number": "${{ github.event.pull_request.number }}",
                "head_ref": "${{ github.head_ref }}",
                "head_sha": "${{ github.event.pull_request.head.sha }}",
                "base_ref": "${{ github.base_ref }}"
              }
            }'
