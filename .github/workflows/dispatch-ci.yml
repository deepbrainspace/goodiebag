name: ğŸš¦ CI Dispatcher

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  dispatch:
    name: ğŸš¦ Route Workflow
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch to appropriate workflow
        run: |
          if [[ ! "${{ github.head_ref }}" =~ ^release/ ]]; then
            echo "ğŸ—ï¸ Triggering build workflow for regular branch"
            curl -X POST \
              -H "Accept: application/vnd.github.v3+json" \
              -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              https://api.github.com/repos/${{ github.repository }}/actions/workflows/build.yml/dispatches \
              -d '{
                "ref": "${{ github.head_ref }}",
                "inputs": {
                  "pr_number": "${{ github.event.pull_request.number }}",
                  "head_ref": "${{ github.head_ref }}",
                  "head_sha": "${{ github.event.pull_request.head.sha }}",
                  "base_ref": "${{ github.base_ref }}"
                }
              }'
          else
            echo "ğŸš€ Triggering release validation for release branch"
            curl -X POST \
              -H "Accept: application/vnd.github.v3+json" \
              -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              https://api.github.com/repos/${{ github.repository }}/actions/workflows/release-validation.yml/dispatches \
              -d '{
                "ref": "${{ github.head_ref }}",
                "inputs": {
                  "pr_number": "${{ github.event.pull_request.number }}",
                  "head_ref": "${{ github.head_ref }}",
                  "head_sha": "${{ github.event.pull_request.head.sha }}",
                  "base_ref": "${{ github.base_ref }}"
                }
              }'
          fi
