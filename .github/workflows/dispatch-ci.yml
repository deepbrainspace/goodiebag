name: ğŸš¦ CI Dispatcher

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  dispatch-build:
    name: ğŸ—ï¸ Dispatch Build Pipeline
    runs-on: ubuntu-latest
    if: "! startsWith(github.head_ref, 'release/')"
    steps:
      - name: Trigger build workflow
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/build.yml/dispatches \
            -d '{
              "ref": "${{ github.head_ref }}",
              "inputs": {
                "pr_number": "${{ github.event.pull_request.number }}",
                "head_ref": "${{ github.head_ref }}",
                "head_sha": "${{ github.event.pull_request.head.sha }}",
                "base_ref": "${{ github.base_ref }}"
              }
            }'

  dispatch-release:
    name: ğŸš€ Dispatch Release Validation
    runs-on: ubuntu-latest
    if: "startsWith(github.head_ref, 'release/')"
    steps:
      - name: Trigger release validation workflow
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/release-validation.yml/dispatches \
            -d '{
              "ref": "${{ github.head_ref }}",
              "inputs": {
                "pr_number": "${{ github.event.pull_request.number }}",
                "head_ref": "${{ github.head_ref }}",
                "head_sha": "${{ github.event.pull_request.head.sha }}",
                "base_ref": "${{ github.base_ref }}"
              }
            }'
